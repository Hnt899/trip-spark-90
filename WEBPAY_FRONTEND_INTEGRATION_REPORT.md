# –û—Ç—á—ë—Ç PROMPT 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WebPay –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

## üìã –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö/—Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/pages/PaymentSuccess.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —Å polling
2. ‚úÖ `src/pages/PaymentCancel.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–º–µ–Ω—ã –æ–ø–ª–∞—Ç—ã

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. ‚úÖ `src/pages/Checkout.tsx` ‚Äî –ø–µ—Ä–µ–¥–µ–ª–∞–Ω `handlePay()`:
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î –î–û –æ–ø–ª–∞—Ç—ã (`payment_status='pending'`)
   - –í—ã–∑–æ–≤ Edge Function `webpay-create`
   - POST-—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WebPay
   - –£–±—Ä–∞–Ω–∞ —Å–∏–º—É–ª—è—Ü–∏—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF

2. ‚úÖ `src/App.tsx` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–æ—É—Ç—ã:
   - `/payment/success` ‚Üí `PaymentSuccess`
   - `/payment/cancel` ‚Üí `PaymentCancel`

---

## üîß –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä—É–∫–∞–º–∏

### –õ–æ–∫–∞–ª—å–Ω–æ (dev)

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   # –í .env.local –∏–ª–∏ .env
   VITE_SUPABASE_URL=https://your-project.supabase.co
   VITE_SUPABASE_ANON_KEY=your_anon_key
   ```

2. **–ó–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   npm run dev
   ```

3. **–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–∞:**
   - –û—Ç–∫—Ä—ã—Ç—å `http://localhost:5173` (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç)
   - –í—ã–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –∏ –º–µ—Å—Ç–æ
   - –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É checkout
   - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
   - –í—ã–±—Ä–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏
   - –ù–∞–∂–∞—Ç—å "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" (–∫–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã)
   - **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
     - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –ë–î —Å `payment_status='pending'`
     - –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WebPay sandbox
     - –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã/–æ—Ç–º–µ–Ω—ã ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/payment/success` –∏–ª–∏ `/payment/cancel`

### Sandbox WebPay

1. **–í WebPay sandbox:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã: —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/payment/success?order=T1234567890`
   - –ü–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã: —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/payment/cancel?order=T1234567890`

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ PaymentSuccess:**
   - –ï—Å–ª–∏ `payment_status='paid'` —Å—Ä–∞–∑—É ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
   - –ï—Å–ª–∏ `payment_status='pending'` ‚Üí polling –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–¥–æ 30 —Å–µ–∫—É–Ω–¥)
   - –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ PaymentCancel:**
   - –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `payment_status='cancelled'` –µ—Å–ª–∏ –±—ã–ª `pending`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è UI "–û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞"
   - –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∏ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞" –∏ "–ù–∞ –≥–ª–∞–≤–Ω—É—é"

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
SELECT id, order_number, payment_status, total_price, created_at 
FROM tickets 
ORDER BY created_at DESC 
LIMIT 5;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ notify
SELECT id, order_number, payment_status, payment_transaction_id, payment_paid_at
FROM tickets
WHERE order_number = 'T1234567890';
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Edge Functions

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ webpay-create
npx supabase functions logs webpay-create

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ webpay-notify
npx supabase functions logs webpay-notify
```

---

## üìä –û—Ç—á—ë—Ç PROMPT 3

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WebPay –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:**
- ‚úÖ –°–∏–º—É–ª—è—Ü–∏—è –æ–ø–ª–∞—Ç—ã –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ Edge Functions
- ‚úÖ `handlePay()` —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –≤ –ë–î –î–û –æ–ø–ª–∞—Ç—ã —Å `payment_status='pending'`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω POST-—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WebPay —á–µ—Ä–µ–∑ auto-submit —Ñ–æ—Ä–º—É
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `PaymentSuccess` —Å polling –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `PaymentCancel` —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ `cancelled`
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `PaymentSuccess` –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
- ‚úÖ –†–æ—É—Ç—ã `/payment/success` –∏ `/payment/cancel` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `App.tsx`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –≤—ã–±–æ—Ä ‚Üí checkout ‚Üí WebPay ‚Üí —É—Å–ø–µ—Ö/–æ—Ç–º–µ–Ω–∞ ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤. –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `payment_status='paid'` –≤ –ë–î (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ notify –æ—Ç WebPay).

---

**–î–∞—Ç–∞:** 2025-01-27  
**–í–µ—Ä—Å–∏—è:** 1.0

